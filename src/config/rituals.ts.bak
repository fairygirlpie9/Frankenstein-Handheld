/**
 * Ritual definitions for the Frankenstein Ritual Game
 * Each ritual represents a complete level with surgical steps
 */

import { Ritual, InputAction, SurgicalObjectType } from './types';

// Level 1 Ritual - Basic Frankenstein Surgery
export const LEVEL_1_RITUAL: Ritual = {
  levelNumber: 1,
  baseTimeLimit: 10,  // Increased from 5 to 10 seconds for beginners
  timeLimitMultiplier: 1.0,
  steps: [
    {
      name: 'Disinfect',
      promptText: 'Disinfect: Press Button 3',
      correctAction: InputAction.BUTTON_3,
      timeLimit: 10,  // Increased from 5 to 10
      surgicalObject: SurgicalObjectType.DISINFECTANT,
      surgeonAnimation: 'spray_disinfectant'
    },
    {
      name: 'Slice Open',
      promptText: 'Slice Open: Move Joystick Up',
      correctAction: InputAction.JOYSTICK_UP,
      timeLimit: 10,  // Increased from 5 to 10
      surgicalObject: SurgicalObjectType.SCALPEL,
      surgeonAnimation: 'slice_incision'
    },
    {
      name: 'Remove Organ',
      promptText: 'Remove Organ: Press Button 4',
      correctAction: InputAction.BUTTON_4,
      timeLimit: 10,  // Increased from 5 to 10
      surgicalObject: SurgicalObjectType.ORGAN,
      surgeonAnimation: 'remove_organ'
    },
    {
      name: 'Connect Wires',
      promptText: 'Connect Wires: D-Pad Right',
      correctAction: InputAction.DPAD_RIGHT,
      timeLimit: 10,  // Increased from 5 to 10
      surgicalObject: SurgicalObjectType.WIRES,
      surgeonAnimation: 'connect_wires'
    },
    {
      name: 'Sew Shut',
      promptText: 'Sew Shut: Move Joystick Down',
      correctAction: InputAction.JOYSTICK_DOWN,
      timeLimit: 10,  // Increased from 5 to 10
      surgicalObject: SurgicalObjectType.NEEDLE_THREAD,
      surgeonAnimation: 'sew_stitches'
    }
  ]
};

/**
 * Get ritual for a specific level number
 * Applies difficulty scaling based on level
 */
export function getRitualForLevel(levelNumber: number): Ritual {
  // Start with base ritual
  const baseRitual = { ...LEVEL_1_RITUAL };
  
  // Apply difficulty scaling
  const timeReduction = 1 - (0.05 * (levelNumber - 1)  // Reduced from 10% to 5% per level); // 10% reduction per level
  const timeLimitMultiplier = Math.max(0.6, timeReduction)  // Minimum 60% (was 50%); // Minimum 50% of original time
  
  // Clone steps and apply time multiplier
  const scaledSteps = baseRitual.steps.map(step => ({
    ...step,
    timeLimit: Math.max(3, Math.floor(step.timeLimit * timeLimitMultiplier))
  }));
  
  // Add extra steps every 3 levels
  const extraStepsCount = Math.floor((levelNumber - 1) / 3);
  if (extraStepsCount > 0) {
    // Add "Clean Tools" step as extra challenge
    for (let i = 0; i < extraStepsCount; i++) {
      scaledSteps.push({
        name: 'Clean Tools',
        promptText: 'Clean Tools: D-Pad Left',
        correctAction: InputAction.DPAD_LEFT,
        timeLimit: Math.max(1, Math.floor(4 * timeLimitMultiplier)),
        surgicalObject: SurgicalObjectType.TOOLS,
        surgeonAnimation: 'clean_tools'
      });
    }
  }
  
  return {
    levelNumber,
    baseTimeLimit: baseRitual.baseTimeLimit,
    timeLimitMultiplier,
    steps: scaledSteps
  };
}

/**
 * Get all available rituals
 */
export const RITUALS = {
  level1: LEVEL_1_RITUAL
};
